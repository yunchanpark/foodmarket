<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<!-- head -->
<th:block th:include="@{/layout/admin/includes/head.html}"></th:block>
<!-- head 끝 -->
	<link th:href="@{/css/product.css}" rel="stylesheet" />
    <title>FoodMarket-상품등록</title>
</head>
<body class="sb-nav-fixed">
    <!--header menu-->
	<th:block th:include="@{/layout/admin/includes/header.html}"></th:block>
    <!--header menu 끝-->
	<!-- 본문 -->
    <div id="layoutSidenav">
        <!--sidebar-->
		<th:block th:include="@{/layout/admin/includes/sidebar.html}"></th:block>
        <!--sidebar 끝-->
        <!--content-->
        <div id="layoutSidenav_content">
            <main>
            <form action="write" method="post" name="frm" id="frm" enctype="multipart/form-data">
                <!--내용 입력-->
                <div class="container-fluid px-4">
                    <div class="mt-4 d-flex justify-content-between">
                        <div class="fs-5 fw-bold align-self-center">• 상품등록</div>
                        <div class="d-flex top-1">
                        	<span class="pil-so txt-1">*필수</span>
	                        <a th:href="@{/}" id="allProductUpload" class="nav-link bg-gray text-white">상품 일괄 업로드</a>
                        </div>
                    </div>
					<!-- =============카테고리=============-->
					<div class="sect-hd mt-5">
					    <h5 class="ps-3">카테고리</h5>
					    <a class="btn-arrow">닫기</a>
					</div>
					<div class="sect-wrap">
					 <div class="sect-cont">
					     <span class="txt">
					         카테고리
					         <span class="pil-so">*</span>
					     </span>
					     <div class="category-base">
					         <select name="categoryNo" id="categoryNo" class="arr-bg arr-size-2">
					         	<th:block th:each="category : ${category}">
					         		<option th:value="${category.categoryNo}">[[${category.name}]]</option>
					         	</th:block>
					         </select>
					         <span class="err">[[${errCategoryNo}]]</span>
					     </div>
					 </div>
					</div>
					<!-- ==================================-->
					
					<!-- =============상품명=============-->
					<div class="sect-hd mt-3">
					    <h5 class="ps-3">상품명</h5>
					    <a class="btn-arrow">닫기</a>
					</div>
					<div class="sect-wrap">
					 <div class="sect-cont">
					     <span class="txt">
					         상품명 
					         <span class="pil-so">*</span>
					     </span>
					     <input type="text" name="name" id="productName" class="arr-bg arr-size-1 productName" th:value="${product.name}"/>
					 	 <span class="err">[[${errProductname}]]</span>
					 </div>
					 <div class="sect-cont no-pil-so">
					     <span class="txt">추가상품명</span>
					     <input type="text" name="description" id="description" class="arr-bg arr-size-1 description" th:value="${product.description}"/>
					 </div>
					</div>
					<!-- =============상품명 끝=============-->
					
					<!-- =============가격=============-->
					<div class="sect-hd mt-3">
					    <h5 class="ps-3">
					        가격 
					    </h5>
					    <a class="btn-arrow">닫기</a>
					</div>
					<div class="sect-wrap">
					 <div class="sect-cont">
					     <span class="txt">
					         판매가격
					         <span class="pil-so">*</span>
					     </span>
					     ₩<input type="text" name="price" id="price" class="arr-bg arr-size-2 price num money" th:value="${product.price}"/>
					 	 <span class="err">[[${errPrice}]]</span>
					 </div>
					 <div class="sect-cont">
					     <span class="txt">
					         매입가
					         <span class="pil-so">*</span>
					     </span>
					     ₩<input type="text" name="purchasePrice" id="purchase_price" class="arr-bg arr-size-2 purchase_price num" th:value="${product.purchasePrice}"/>
					 	 <span class="err">[[${errPurchasePrice}]]</span>
					 </div>
					 <div class="sect-cont no-pil-so">
					     <span class="txt">
					         할인
					     </span>
					     <input type="radio" name="discountCk" id="discount-yes" value="Y" class="radio-btn">
					     <label for="discount-yes" class="dis-lab">사용함</label>
					     <input type="radio" name="discountCk" id="discount-no" value="N" class="radio-btn" checked>
					     <label for="discount-no" class="dis-lab">사용안함</label>
					 </div>
					 <div class="prdSale">
					  <div class="sect-cont no-pil-so bg-yellow">
					      <span class="txt">
					          즉시할인
					      </span>
					      <input type="text" id="discount" class="arr-bg arr-size-3 discount num money" name="discount" th:value="${product.discount}"/>
					      <select name="exchangeRate" id="exchangeRate" class="arr-bg arr-size-4">
					          <option value="percent">%</option>
					          <option value="won">원</option>
					      </select>
					      <input type="checkbox" name="duringCheck" id="during-check" class="during-check" value="Y"/>
					      <label for="during-check">기간 할인 설정</label>
					      <span class="err">[[${errDiscount}]]</span>
					  </div>
					  <div class="sect-cont no-pil-so bg-yellow sale-datetime">
					      <span class="txt">
					          기간설정
					      </span>
					      <div class="calendar">
					          <input type="datetime-local" name="startDate" id="discount-start" class="discount-calendar discount-start"/>
					          <span class="sep">~</span>
					          <input type="datetime-local" name="endDate" id="discount-end" class="discount-calendar discount-end"/>
					      </div>
					      <span class="err">[[${errDiscountTime}]]</span>
					  </div>
					  <div class="sect-cont no-pil-so bg-yellow">
					      <span class="txt">
					          할인가
					      </span>
					      <span class="last-price fs-4 fw-bold text-primary total">0원</span>
					      <span class="fs-7 ms-2">
					          (<span class="discount-price discount_price">0</span>)원 할인
					      </span>
					  </div>
					 </div>
					</div>
					<!-- =============가격 끝=============-->
					
					<!-- =============상품 이미지=============-->
					<div class="sect-hd mt-3">
					    <h5 class="ps-3">상품이미지</h5>
					    <a class="btn-arrow">닫기</a>
					</div>
					<div class="sect-wrap">
					 <div class="sect-cont">
					     <span class="txt">
					         이미지  
					         <span class="pil-so">*</span>
					     </span>
					     <input type="text" id="product_image_value" class="arr-bg arr-size-2 product_image_value" disabled/>
					     <input type="file" name="image" id="product_image_orgin_name" class="product_image_orgin_name"/>
					     <label for="product_image_orgin_name" class="product_image_label">
					     	파일선택
					     </label>
					     <span class="err">[[${errImage}]]</span>
					 </div>
					</div>
					<!-- =============상품 이미지 끝=============-->
					
					<!-- =============재고=============-->
					<div class="sect-hd mt-3">
					    <h5 class="ps-3">재고</h5>
					    <a class="btn-arrow">닫기</a>
					</div>
					<div class="sect-wrap">
					 <div class="sect-cont">
					 	<span class="txt">
					         재고
					         <span class="pil-so">*</span>
					     </span>
					     <input type="text" class="arr-bg arr-size-2 num" id="sctock" name="stock" th:value="${product.stock}">
					     <span class="err">[[${errStock}]]</span>
					 </div>
					</div>
					<!-- =============재고 끝=============-->
					
					<!-- =============상세설명=============-->
					<div class="sect-hd mt-3">
					    <h5 class="ps-3">상세설명</h5>
					    <a class="btn-arrow">닫기</a>
					</div>
					<div class="sect-wrap">
						<textarea rows="10" cols="80" name="detailContent" id="detailContent" class="detailContent"></textarea>
					</div>
					<!-- =============상세설명 끝=============-->
					<input type="submit" class="btn-h52-blue w180 mr-20 btn-add-notice submit_btn" value="등록"/>
                </div>
                <!--내용 입력 끝-->
            </form>
            </main>
            <!--footer-->
			<th:block th:include="@{/layout/admin/includes/footer.html}"></th:block>
            <!--footer 끝-->
        </div>
        <!--content 끝-->
    </div>
	<!-- 본문 끝 -->
    <!--plugin-->
	<th:block th:include="@{/layout/admin/includes/plugin.html}"></th:block>
	<script th:src="@{/ckeditor/ckeditor.js}"></script>
	<script type="text/javascript">
		/* 상품상세설명 ckeditor*/
		CKEDITOR.replace("detailContent");
	</script>
	<!-- 상품등록 binding 값 초기화 -->
    <script th:if="${result == 0}" th:inline="javascript">
    /*<![CDATA[*/
    	let product = /*[[${product}]]*/ null;
    	let categoryNo = /*[[${product.categoryNo.categoryNo}]]*/ null;
   		let discountCk = /*[[${product.discountCk}]]*/ null;
   		let discount = /*[[${product.discount}]]*/ null;
    	let duringCheck = /*[[${product.duringCheck}]]*/ 'Y';
    	let exchangeRate = /*[[${product.exchangeRate}]]*/ 'percent';
    	let startDate = /*[[${product.startDate}]]*/ null;
		let endDate = /*[[${product.endDate}]]*/ null;
		let detailContent = /*[[${product.detailContent}]]*/ null;

		let offset = new Date().getTimezoneOffset() * 60000;
		let start = new Date(new Date(startDate) - offset).toISOString().slice(0,16);
		let end = new Date(new Date(endDate) - offset).toISOString().slice(0,16);
		
    	$('.btn-arrow').addClass("up");
    	$('#categoryNo').val(categoryNo).prop('selected', true);
    	$("#exchangeRate").val(exchangeRate).prop('selected', true);
  	
    	// 할인 사용 체크 되어 있을 때
    	if(discountCk == 'Y') {
    		discount = discount == null ? undefined : discount;
    		$(".discount").val(discount);
    		$("input:radio[name='discountCk']:radio[value='Y']").prop('checked', true); 
	    	$('.prdSale').show();
    	}
    	
    	// 기간 할인 설정 체크 되어있을 때 
		if (duringCheck == 'Y') {
			$("input:checkbox[id='during-check']").prop("checked", true);
			$('.sale-datetime').show();
			$(".discount-start").val(start);    	
			$(".discount-end").val(end);  
		}
		CKEDITOR.instances.detailContent.setData(detailContent, {
			callback: function() {
				this.checkDirty(); // true
			}
		});
		/*]]>*/
	</script>
	<script th:src="@{/js/product.js}"></script>
    <!--plugin끝-->
</body>
</html>